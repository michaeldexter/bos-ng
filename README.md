# bos-ng
Extensions to the FreeBSD build_option_survey

The Build Option Survey or BOS builds a default reference build of FreeBSD
world and kernel, installs them to a memory disk-attached UFS-formatted disk
image, and repeats this process with each "build option" described in the
src.conf(5) manual page. Metadata for each iterative build is compared to the
reference build using reduce.sh, which is called by mkhtml.sh and produces an
HTML-formatted summary of the success or failure of each build option, with
statistics on the number of bytes added or removed by the option.

listallopts.sh lists all of the avialble options and can provide a sense of how
long a full build option survey run will take to complete. i.e.:

sh listallopts.sh | wc -l

Multiply the resulting number by the time your system takes for a complete
buildworld and buildkernel.

Beauase the build option survey is repetitive and write intensive, consider
mounting /usr/obj with tmpfs using 'mount -t tmpfs tmpfs /usr/obj'.

The results of the build option survey are located in:

/usr/obj/usr/src/tools/tools/build_option_survey/

The results of mkhtml.sh are located in:

/usr/obj/usr/src/tools/tools/build_option_survey/HTML/

calctimes.sh provides the execution time of each build based on the first and
last modified files.

findfaults.sh attempts to isolate the build failure of any give failed build.


This version of the build option survey adds support for:

1. Preservation of a successful reference build, rather than deleting it.

2. Support for a quoted, space-sparated list as a command-line argument of
   desired build options to test, i.e.:
   sh build_option_survey.sh "WITHTOUT_CDDL WITHOUT_CROSS_COMPILER"

3. Addition of '\time -h' before every make command to preserve execution time.

4. Additional reporting during execution


CAVEATS

The build_option_survey is hard-coded to work under /usr/src/tools/tools/

The build_option_survey relies heavily on return values and is executed with
'set -ex' and will thus exit on all errors in additoin to providing verbose
execution output. Add new tests with this in mind.

FYI, the src-env.conf error is generated by share/mk/src.sys.mk

No software should ever be named -ng, but a non-conflicting name was needed.

The build option survey was authored by Poul-Henning Kamp and has been extended 
by Michael Dexter.
